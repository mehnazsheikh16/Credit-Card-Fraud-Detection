<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Credit Card Fraud Detection Demo</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .container { max-width: 600px; margin: auto; }
        input, button { margin: 5px 0; width: 100%; padding: 8px; }
        .result { margin-top: 20px; font-size: 1.2em; }
    </style>
</head>
<body>
<div class="container">
    <h2>Credit Card Fraud Detection</h2>
    <form id="fraudForm">
        <div id="inputs"></div>
        <button type="button" id="fillSample">Fill with Sample Data</button>
        <button type="submit">Predict</button>
    </form>
    <div class="result" id="result"></div>
</div>
<script>
// List of features expected by the model (order matters)
const features = [
    "Time",
    "V1", "V2", "V3", "V4", "V5", "V6", "V7", "V8", "V9", "V10",
    "V11", "V12", "V13", "V14", "V15", "V16", "V17", "V18", "V19", "V20",
    "V21", "V22", "V23", "V24", "V25", "V26", "V27", "V28",
    "Amount"
];

const inputsDiv = document.getElementById('inputs');
features.forEach(f => {
    const label = document.createElement('label');
    label.textContent = f;
    const input = document.createElement('input');
    input.type = 'number';
    input.step = 'any';
    input.name = f;
    input.required = true;
    inputsDiv.appendChild(label);
    inputsDiv.appendChild(input);
});


// Sample data from the first row of the Kaggle dataset (not fraud)
const sampleData = {
    "V1": -1.3598071336738,
    "V2": -0.0727811733098497,
    "V3": 2.53634673796914,
    "V4": 1.37815522427443,
    "V5": -0.338320769942518,
    "V6": 0.462387777762292,
    "V7": 0.239598554061257,
    "V8": 0.0986979012610507,
    "V9": 0.363786969611213,
    "V10": 0.0907941719789316,
    "V11": -0.551599533260813,
    "V12": -0.617800855762348,
    "V13": -0.991389847235408,
    "V14": -0.311169353699879,
    "V15": 1.46817697209427,
    "V16": -0.470400525259478,
    "V17": 0.207971241929242,
    "V18": 0.0257905801985591,
    "V19": 0.403992960255733,
    "V20": 0.251412098239705,
    "V21": -0.018306777944153,
    "V22": 0.277837575558899,
    "V23": -0.110473910188767,
    "V24": 0.0669280749146731,
    "V25": 0.128539358273528,
    "V26": -0.189114843888824,
    "V27": 0.133558376740387,
    "V28": -0.0210530534538215,
    "Amount": 149.62,
    "Time": 0.0
};

document.getElementById('fillSample').onclick = function() {
    features.forEach(f => {
        document.getElementsByName(f)[0].value = sampleData[f];
    });
};

document.getElementById('fraudForm').onsubmit = async function(e) {
    e.preventDefault();
    const data = {};
    features.forEach(f => {
        data[f] = parseFloat(document.getElementsByName(f)[0].value);
    });
    document.getElementById('result').textContent = 'Predicting...';
    try {
        const response = await fetch('http://127.0.0.1:5001/predict', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        const result = await response.json();
        document.getElementById('result').textContent =
            `Prediction: ${result.prediction === 1 ? 'Fraud' : 'Not Fraud'} (Probability: ${result.probability.toFixed(2)})`;
    } catch (err) {
        document.getElementById('result').textContent = 'Error: ' + err;
    }
};

// Batch CSV upload
// Add minimal UI elements dynamically for batch predictions
(function addBatchUI() {
    const container = document.querySelector('.container');
    const h3 = document.createElement('h3');
    h3.textContent = 'Batch Prediction (CSV)';
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.csv';
    fileInput.id = 'batchFile';
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.id = 'runBatch';
    btn.textContent = 'Run Batch';
    const batchDiv = document.createElement('div');
    batchDiv.id = 'batchResult';
    batchDiv.style.marginTop = '10px';
    container.appendChild(h3);
    container.appendChild(fileInput);
    container.appendChild(btn);
    container.appendChild(batchDiv);

    btn.onclick = async () => {
        const file = fileInput.files && fileInput.files[0];
        if (!file) {
            batchDiv.textContent = 'Please choose a CSV file first.';
            return;
        }
        batchDiv.textContent = 'Uploading and scoring...';
        try {
            const formData = new FormData();
            formData.append('file', file);
            const resp = await fetch('http://127.0.0.1:5001/batch_predict', {
                method: 'POST',
                body: formData
            });
            if (!resp.ok) {
                // try to parse error json
                let errText = await resp.text();
                try { const j = JSON.parse(errText); errText = j.error || errText; } catch {}
                batchDiv.textContent = 'Error: ' + errText;
                return;
            }
            const blob = await resp.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'batch_predictions.csv';
            a.textContent = 'Download predictions CSV';
            batchDiv.innerHTML = '';
            batchDiv.appendChild(a);
        } catch (err) {
            batchDiv.textContent = 'Error: ' + err;
        }
    };
})();
</script>
</body>
</html>
